<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Hugo Server doesn't See File Notification Events in WSL2</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=https://parsiya.io/clone.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.io/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia-Clone"><meta name=generator content="Hugo 0.107.0"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hugo Server doesn't See File Notification Events in WSL2"><meta name=twitter:description content="Problem The local Hugo server running in WSL2 doesn't see file updates so it doesn't rebuild the website. The files are under the Windows file system (e.g., /mnt/c/...).
Solution Move the file to the WSL2 subsystem (e.g., ~/...).
Details Note: I am using this section to document my workflow and extra information for later reference.
VS Code Task I've got a fun little setup for using Hugo in VS Code."><meta name=twitter:domain content="parsiya.io"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.io/>Parsia-Clone</a></h1><h2>'Documentation is a love letter that you write to your future self.' - Damian Conway</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://github.com/parsiya/Parsia-Clone>» Parsia-Clone on Github</option><option value=https://parsiya.net/categories/clone/>» How did I make this?</option><option value=https://parsiya.net>» My Main Website</option></select></fieldset><ul class=main-navigation><li><a href=https://github.com/parsiya/Parsia-Clone title="Parsia-Clone on Github" target=_blank rel="noopener noreferrer">Parsia-Clone on Github</a></li><li><a href=https://parsiya.net/categories/clone/ title="How did I make this?" target=_blank rel="noopener noreferrer">How did I make this?</a></li><li><a href=https://parsiya.net title="My Main Website" target=_blank rel="noopener noreferrer">My Main Website</a></li></ul><ul class=subscription></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>3 minute read
- <a class=label href=https://parsiya.io/categories/random/>Random</a></p><h1 class=entry-title>Hugo Server doesn't See File Notification Events in WSL2</h1><a href=https://github.com/parsiya/Parsia-Clone/tree/main/random/wsl2-hugo-watch.markdown target=_blank>Github Link</a></header><div class=entry-content><h1 id=problem>Problem
<a class=header-link href=#problem><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>The local Hugo server running in WSL2 doesn't see file updates so it doesn't
rebuild the website. The files are under the Windows file system (e.g.,
<code>/mnt/c/...</code>).</p><h1 id=solution>Solution
<a class=header-link href=#solution><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Move the file to the WSL2 subsystem (e.g., <code>~/...</code>).</p><h1 id=details>Details
<a class=header-link href=#details><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Note: I am using this section to document my workflow and extra information for
later reference.</p><h2 id=vs-code-task>VS Code Task
<a class=header-link href=#vs-code-task><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I've got a fun little setup for using Hugo in VS Code. I have set the default
build task to run the local server and open a browser window. With a single
<code>ctrl+shift+b</code> the server runs and shows the generated website. When I modify a
file, the website is rebuilt and it navigates to the modified section.</p><p>This is done with this VS Code task.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;version&#34;</span>: <span style=color:#2aa198>&#34;2.0.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;tasks&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;label&#34;</span>: <span style=color:#2aa198>&#34;start-hugo-server&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;type&#34;</span>: <span style=color:#2aa198>&#34;shell&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;command&#34;</span>: <span style=color:#2aa198>&#34;hugo server -v --navigateToChanged&#34;</span>, <span style=color:#586e75>// if the default VS Code terminal on Windows is cmd, use `wsl.exe hugo serve -vw`
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>            <span style=color:#268bd2>&#34;isBackground&#34;</span>: <span style=color:#cb4b16>true</span>    <span style=color:#586e75>// this is a watch process that keeps running
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#586e75>// opens http://localhost:1313 in the system browser to preview the site.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>            <span style=color:#268bd2>&#34;label&#34;</span>: <span style=color:#2aa198>&#34;open-browser-1313&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;type&#34;</span>: <span style=color:#2aa198>&#34;shell&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;command&#34;</span>: <span style=color:#2aa198>&#34;/c start http://localhost:1313&#34;</span>, <span style=color:#586e75>// Windows only thing.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>            <span style=color:#268bd2>&#34;options&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#268bd2>&#34;shell&#34;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;executable&#34;</span>: <span style=color:#2aa198>&#34;cmd.exe&#34;</span>, <span style=color:#586e75>// My VS Code&#39;s default shell is wsl so I have to change the shell to cmd.exe here.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;label&#34;</span>: <span style=color:#2aa198>&#34;preview-blog&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#586e75>// runs both of these together
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>            <span style=color:#268bd2>&#34;dependsOn&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#2aa198>&#34;start-hugo-server&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#2aa198>&#34;open-browser-1313&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;group&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#268bd2>&#34;kind&#34;</span>: <span style=color:#2aa198>&#34;build&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#268bd2>&#34;isDefault&#34;</span>: <span style=color:#cb4b16>true</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There are two tasks:</p><ol><li><code>start-hugo-server</code>: Runs the Hugo server in WSL. It watches for changes by default
(no need to supply <code>-w</code> anymore) and <code>--navigateToChanged</code> navigates the
browser to the latest file modified so I automagically see the modified
section without any clicks.</li><li><code>open-browser-1313</code>: Opens the browser on Windows and goes to the URL that
servers the local website.</li></ol><p>I recently switched from an old Ubuntu 18 WSL 1 instance to a Debian 11 running
under WSL2. The local copy of my website was under the Windows file system and
<strong>when I modified the files in VS Code, the server did not see the file updates</strong>
so the website was not rebuilt.</p><h2 id=wsl-1-vs-wsl-2>WSL 1 vs. WSL 2
<a class=header-link href=#wsl-1-vs-wsl-2><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>WSL 1 and 2 have differences in terms of performance and
implementation. See <a href=https://learn.microsoft.com/en-us/windows/wsl/compare-versions#comparing-features target=_blank rel="noreferrer noopener">Comparing WSL 1 and WSL 2</a>.</p><p>The only thing I care about is "file system performance."</p><ul><li>WSL 1 has better performance across the board.</li><li>WSL 2 has better performance for files in its own file system (e.g., <code>~/...</code>).</li></ul><p>The reason is mainly behind the <code>Managed VM</code> feature of WSL 2. When I had Ubuntu
18 on WSL 1, I could go to
<code>%LocalAppData%/packages/CanonicalGroupLimited.Ubuntu18.04onWindows_79rhkp1fndgsc/LocalState</code>
and see the entire file system there. In other words, each Linux file was a
separate file.</p><p>For my Debian 11 running on WSL 2, I go to
<code>%LocalAppData%/Packages/TheDebianProject.DebianGNULinux_76v4gfsz19hv4/LocalState</code>
and I see <code>ext4.vhdx</code> (which is a Hyper-V virtual hard disk format). If you want
to see access the files system, you can paste this in the run menu:
<code>\\wsl$\Debian</code>.</p><p>Where <code>Debian</code> is the name of the distro. You can see all of them with <code>wsl.exe -l -v</code>. This works both on Windows and inside WSL. Make sure you're pasting the
command as-is. <code>wsl -l -v</code> in WSL won't work, it must be <code>wsl.exe -l -v</code>.</p><h2 id=what-was-the-solution>What was the Solution?
<a class=header-link href=#what-was-the-solution><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I copied my entire local git directory to Debian's home. It took a while but I
realized I do almost all of my development in WSL so why not take advantage of
it.</p><p>On a side note, you can convert a WSL 1 distro to WSL 2 and back. It takes a few
minutes mainly because files must be copied from one file system to the other.</p><pre tabindex=0><code>wsl --set-version {DistroName} 2 # or 1
</code></pre></div><footer><p class=meta><span class=categories>Tags:
<a class=category href=https://parsiya.io/tags/hugo>hugo</a> <a class=category href=https://parsiya.io/tags/wsl2>wsl2</a></span></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#problem>Problem</a></li><li><a href=#solution>Solution</a></li><li><a href=#details>Details</a><ul><li><a href=#vs-code-task>VS Code Task</a></li><li><a href=#wsl-1-vs-wsl-2>WSL 1 vs. WSL 2</a></li><li><a href=#what-was-the-solution>What was the Solution?</a></li></ul></li></ul></nav></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2022 Parsia-Clone - <a href=https://parsiya.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>