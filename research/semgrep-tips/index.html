<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Semgrep Tips and Tricks</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=https://parsiya.io/clone.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.io/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia-Clone"><meta name=generator content="Hugo 0.106.0"><meta name=twitter:card content="summary"><meta name=twitter:title content="Semgrep Tips and Tricks"><meta name=twitter:description content="Semgrep on Windows As of today (November 2022), you cannot run Semgrep directly on Windows. Seriously, save your sanity and don't try. But you can run it in the Windows Subsystem for Linux.
Install WSL I won't go into the details. Use the Install Linux on Windows with WSL guide from Microsoft.
Which Distro Should I Choose? It's your call. My current daily WSL2 driver is Debian 11. I have used Semgrep in multiple versions of Ubuntu and Debian without issues."><meta name=twitter:domain content="parsiya.io"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.io/>Parsia-Clone</a></h1><h2>'Documentation is a love letter that you write to your future self.' - Damian Conway</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://github.com/parsiya/Parsia-Clone>» Parsia-Clone on Github</option><option value=https://parsiya.net/categories/clone/>» How did I make this?</option><option value=https://parsiya.net>» My Main Website</option></select></fieldset><ul class=main-navigation><li><a href=https://github.com/parsiya/Parsia-Clone title="Parsia-Clone on Github" target=_blank>Parsia-Clone on Github</a></li><li><a href=https://parsiya.net/categories/clone/ title="How did I make this?" target=_blank>How did I make this?</a></li><li><a href=https://parsiya.net title="My Main Website" target=_blank>My Main Website</a></li></ul><ul class=subscription></ul><form action=https://www.google.com/search method=get target=_blank><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>5 minute read
- <a class=label href=https://parsiya.io/categories/research/>Research</a></p><h1 class=entry-title>Semgrep Tips and Tricks</h1><a href=https://github.com/parsiya/Parsia-Clone/tree/main/research/semgrep-tips/index.markdown target=_blank>Github Link</a></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#semgrep-on-windows>Semgrep on Windows</a><ul><li><a href=#install-wsl>Install WSL</a></li><li><a href=#which-distro-should-i-choose>Which Distro Should I Choose?</a></li><li><a href=#wsl1-vs-wsl2>WSL1 vs. WSL2</a></li><li><a href=#install-semgrep-on-wsl>Install Semgrep on WSL</a><ul><li><a href=#semgrep-command-not-found>Semgrep Command not Found</a></li></ul></li></ul></li><li><a href=#configs>Configs</a><ul><li><a href=#download-a-ruleset-yaml-file>Download a Ruleset YAML File</a></li><li><a href=#run-all-the-rules>Run ALL the Rules</a></li></ul></li><li><a href=#writing-rules>Writing Rules</a><ul><li><a href=#double-matches-with-different-semgrep-messages>Double Matches with Different Semgrep Messages</a><ul><li><a href=#fix>Fix</a></li><li><a href=#explanation>Explanation</a></li></ul></li><li><a href=#skipping-java-annotations>Skipping Java Annotations</a><ul><li><a href=#fix-1>Fix</a></li></ul></li><li><a href=#pattern-inside-and--or>pattern-inside AND & OR</a></li><li><a href=#if-statements-in-cc>if Statements in C/C++</a></li><li><a href=#array-arguments-in-cc>Array Arguments in C/C++</a><ul><li><a href=#explanation-1>Explanation</a></li></ul></li></ul></li><li><a href=#rule-tests>Rule Tests</a><ul><li><a href=#test-file-names-for-rules-with-the-paths-tag>Test File Names for Rules with the paths Tag</a></li></ul></li><li><a href=#memes>Memes</a><ul><li><a href=#you-made-this>You Made This?</a></li></ul></li></ul></nav><h1 id=semgrep-on-windows>Semgrep on Windows
<a class=header-link href=#semgrep-on-windows><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>As of today (November 2022), <strong>you cannot run Semgrep directly on Windows</strong>.
Seriously, save your sanity and don't try. But you can run it in the
<a href=https://learn.microsoft.com/en-us/windows/wsl/ target=_blank rel="noreferrer noopener">Windows Subsystem for Linux</a>.</p><h2 id=install-wsl>Install WSL
<a class=header-link href=#install-wsl><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I won't go into the details. Use the
<a href=https://learn.microsoft.com/en-us/windows/wsl/install target=_blank rel="noreferrer noopener">Install Linux on Windows with WSL</a> guide from Microsoft.</p><h2 id=which-distro-should-i-choose>Which Distro Should I Choose?
<a class=header-link href=#which-distro-should-i-choose><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>It's your call. My current daily WSL2 driver is Debian 11. I have used Semgrep
in multiple versions of Ubuntu and Debian without issues.</p><p>Make sure you're using a recent Linux version that supports installing Python
3.7 or higher via its package manager (why install it manually when you can make
your life easier?).</p><p>Note you can <a href=https://parsiya.net/cheatsheet/#import-and-export target=_blank rel="noreferrer noopener">have multiple versions of the same distro</a>.</p><h2 id=wsl1-vs-wsl2>WSL1 vs. WSL2
<a class=header-link href=#wsl1-vs-wsl2><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>See <a href=https://learn.microsoft.com/en-us/windows/wsl/compare-versions target=_blank rel="noreferrer noopener">Comparing WSL 1 and WSL 2</a>.</p><p><strong>Are most of your files on the Windows file system? Use WSL1.</strong></p><p>WSL2 uses Hyper-V and so has good performance for files on its own file system
(e.g., <code>~/...</code>). I use WSL2.</p><p><strong>Are you behind a corporate proxy using VPN software (e.g., Cisco AnyConnect)?
Use WSL1.</strong></p><p>Hyper-V has issues connecting to VPN when you use certain VPN software. I have
spent hundreds of hours trying to fix it. You might think you can fix it but
just use WSL1 and save some time.</p><p><a href=https://parsiya.io/random/wsl2-hugo-watch/ target=_blank rel="noreferrer noopener">WSL2 also does not get inotify events for files on the Windows file system</a>.</p><p><strong>Easily switch between WSL1 and WSL2</strong></p><p><code>wsl -l -v</code> to see all the distros.</p><p><code>wsl --set-version &lt;distro name> 2</code> or <code>wsl --set-version &lt;distro name> 1</code>.</p><p>It might take a few minutes to copy the files but it generally works.</p><h2 id=install-semgrep-on-wsl>Install Semgrep on WSL
<a class=header-link href=#install-semgrep-on-wsl><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><code>python3 -m pip install semgrep</code> or <code>python -m pip install semgrep</code> (depending
on distro).</p><h3 id=semgrep-command-not-found>Semgrep Command not Found
<a class=header-link href=#semgrep-command-not-found><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><ol><li>Look for Semgrep in <code>~/.local/bin</code>.</li><li>Add it to your path by adding the following line to <code>~/.bashrc</code> or
<code>~/.profile</code> (my preference).<ul><li><code>export PATH=$PATH:~/.local/bin</code></li></ul></li><li>Run <code>source ~/.profile</code> or <code>source ~/.bashrc</code> to make the change.</li></ol><hr><h1 id=configs>Configs
<a class=header-link href=#configs><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><h2 id=download-a-ruleset-yaml-file>Download a Ruleset YAML File
<a class=header-link href=#download-a-ruleset-yaml-file><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>This will download the YAML file with all the rules.</p><pre tabindex=0><code># p/{ruleset-name}

# this will download the default ruleset in a file named `default`
wget https://semgrep.dev/c/p/default

# note it&#39;s capital O (O as in Oscar, not zero)
wget https://semgrep.dev/c/p/default -O default.yaml

# you can also use curl or even your browser
curl https://semgrep.dev/c/p/default
</code></pre><p><strong>Note:</strong> These URLs are for internal usage and are subject to change.</p><h2 id=run-all-the-rules>Run ALL the Rules
<a class=header-link href=#run-all-the-rules><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><ul><li>Throw the kitchen sink at your code: <code>--config r/all</code>.</li><li>Run the manually created "catch them all" scan: <code>--config p/default</code>.</li></ul><p>Note: Semgrep is intelligent and detects a file's language by extension so it
will not every rule on every file.</p><h1 id=writing-rules>Writing Rules
<a class=header-link href=#writing-rules><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><h2 id=double-matches-with-different-semgrep-messages>Double Matches with Different Semgrep Messages
<a class=header-link href=#double-matches-with-different-semgrep-messages><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I was printing the type of a metavariable.
<a href=https://semgrep.dev/playground/s/parsiya:tips-double-match target=_blank rel="noreferrer noopener">https://semgrep.dev/playground/s/parsiya:tips-double-match</a></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#268bd2>id</span>: tips-double-match
</span></span><span style=display:flex><span>    <span style=color:#268bd2>pattern</span>: $RETTYPE $METHOD() { ... }
</span></span><span style=display:flex><span>    <span style=color:#268bd2>message</span>: $RETTYPE
</span></span><span style=display:flex><span>    <span style=color:#268bd2>severity</span>: WARNING
</span></span><span style=display:flex><span>    <span style=color:#268bd2>languages</span>:
</span></span><span style=display:flex><span>      - java
</span></span></code></pre></div><p>It was matched twice.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#719e07>package</span> pk<span style=color:#719e07>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> org.foo.bar.MyType<span style=color:#719e07>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>MyClass</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>public</span> MyType <span style=color:#268bd2>method</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        <span style=color:#586e75>// do something
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        <span style=color:#719e07>return</span> MyType<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;123&#34;</span><span style=color:#719e07>);</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><p>Once with the type and once with the complete import name.</p><pre tabindex=0><code>Line 7
MyType

Line 7
org.foo.bar.MyType
</code></pre><h3 id=fix>Fix
<a class=header-link href=#fix><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>One fix (credit: <a href=https://github.com/LewisArdern target=_blank rel="noreferrer noopener">Lewis Ardern, r2c</a>,
<a href="https://r2c-community.slack.com/archives/C018NJRRCJ0/p1666654970257119?thread_ts=1666654882.737839&cid=C018NJRRCJ0" target=_blank rel="noreferrer noopener">source</a>) is to add it to <code>focus-metavariable</code>. Note,
how we need to add <code>patterns</code> to have <code>focus-metavariable</code> as a tag.</p><p><a href=https://semgrep.dev/playground/s/parsiya:tips-double-match-fix target=_blank rel="noreferrer noopener">https://semgrep.dev/playground/s/parsiya:tips-double-match-fix</a></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#268bd2>id</span>: tips-double-match-fix
</span></span><span style=display:flex><span>    <span style=color:#268bd2>patterns</span>:
</span></span><span style=display:flex><span>      - <span style=color:#268bd2>pattern</span>: $RETTYPE $METHOD() { ... }
</span></span><span style=display:flex><span>      - <span style=color:#268bd2>focus-metavariable</span>: $RETTYPE
</span></span><span style=display:flex><span>    <span style=color:#268bd2>message</span>: $RETTYPE
</span></span><span style=display:flex><span>    <span style=color:#268bd2>severity</span>: WARNING
</span></span><span style=display:flex><span>    <span style=color:#268bd2>languages</span>:
</span></span><span style=display:flex><span>      - java
</span></span></code></pre></div><h3 id=explanation>Explanation
<a class=header-link href=#explanation><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Credit: <a href=https://github.com/IagoAbal target=_blank rel="noreferrer noopener">Iago Abal</a>, r2c, <a href="https://r2c-community.slack.com/archives/C018NJRRCJ0/p1666705798027529?thread_ts=1666654882.737839&cid=C018NJRRCJ0" target=_blank rel="noreferrer noopener">source on r2c Slack</a>.</p><blockquote><p>For Semgrep <code>MyType</code> is also equivalent to <code>org.foo.bar.MyType</code>, so when you
ask Semgrep to match <code>$RETTYPE</code> against <code>MyType</code> it produces those two matches.
And because <code>$RETTYPE</code> is part of the rule message, each match produces a
different message, and <strong>Semgrep doesn't deduplicate two findings if each
finding has a different message</strong>. I think <code>focus-metavariable</code> removes the
duplicate because the "fake" <code>org.foo.bar.MyType</code> expression that we generate as
equivalent to <code>MyType</code> uses tokens from the <code>import</code> and so the ranges of those
tokens do not intersect with the method declaration... I see that more like a
bug.</p></blockquote><blockquote><p>These double-matches you can observe them with other equivalences as in
<a href=https://semgrep.dev/s/QDdD target=_blank rel="noreferrer noopener">https://semgrep.dev/s/QDdD</a>, because <code>&</code> is commutative and Semgrep does some
AC-matching, <code>$A</code> may be both <code>x</code> and <code>y</code>, so you get two matches.</p></blockquote><h2 id=skipping-java-annotations>Skipping Java Annotations
<a class=header-link href=#skipping-java-annotations><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Assume we have a file like this:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#268bd2>@Annotation1</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ParentClass</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>@First</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>@Second</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>@Third</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>public</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>meth1</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        <span style=color:#719e07>return</span> 1<span style=color:#719e07>;</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><p>And I wanted to skip all annotations after <code>@First</code>. This is not a valid pattern:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>pattern</span>: |<span style=color:#2aa198>
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  @First
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  ...
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  public $RETURNTYPE $METHOD(...) { ... }</span>  
</span></span></code></pre></div><p><a href=https://semgrep.dev/playground/s/parsiya:tips-java-annotations target=_blank rel="noreferrer noopener">https://semgrep.dev/playground/s/parsiya:tips-java-annotations</a></p><h3 id=fix-1>Fix
<a class=header-link href=#fix-1><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Credit: <a href=https://github.com/kopecs target=_blank rel="noreferrer noopener">Cooper Pierce</a>, r2c, <a href="https://r2c-community.slack.com/archives/C018NJRRCJ0/p1666327030925379?thread_ts=1666326171.514289&cid=C018NJRRCJ0" target=_blank rel="noreferrer noopener">source on r2c slack</a>.</p><blockquote><p>annotations beyond those specified are ignored when matching so something like
[the following] would do what you describe</p></blockquote><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#268bd2>id</span>: tips-java-annotations
</span></span><span style=display:flex><span>    <span style=color:#268bd2>pattern</span>: |<span style=color:#2aa198>
</span></span></span><span style=display:flex><span><span style=color:#2aa198>      @First
</span></span></span><span style=display:flex><span><span style=color:#2aa198>      public $RETURNTYPE $METHOD(...) { ... }</span>      
</span></span><span style=display:flex><span>    <span style=color:#268bd2>message</span>: |<span style=color:#2aa198>
</span></span></span><span style=display:flex><span><span style=color:#2aa198>      </span>      $CLASS
</span></span><span style=display:flex><span>    <span style=color:#268bd2>severity</span>: WARNING
</span></span><span style=display:flex><span>    <span style=color:#268bd2>languages</span>:
</span></span><span style=display:flex><span>      - java
</span></span></code></pre></div><p><a href=https://semgrep.dev/playground/s/parsiya:tips-java-annotations-fix target=_blank rel="noreferrer noopener">https://semgrep.dev/playground/s/parsiya:tips-java-annotations-fix</a></p><h2 id=pattern-inside-and--or>pattern-inside AND & OR
<a class=header-link href=#pattern-inside-and--or><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>This is <code>AND</code>. The match must satisfy both.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#268bd2>pattern-inside</span>: ...
</span></span><span style=display:flex><span>- <span style=color:#268bd2>pattern-inside</span>: ...
</span></span></code></pre></div><p>This is <code>OR</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#268bd2>pattern-either</span>:
</span></span><span style=display:flex><span>  - <span style=color:#268bd2>pattern-inside</span>: ...
</span></span><span style=display:flex><span>  - <span style=color:#268bd2>pattern-inside</span>: ...
</span></span></code></pre></div><h2 id=if-statements-in-cc>if Statements in C/C++
<a class=header-link href=#if-statements-in-cc><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Capture Conditions of <code>if</code> Statements in C/C++: <code>if ($X)</code>.</p><p>Capture <code>if</code> conditions with one line blocks.</p><p><a href=https://semgrep.dev/playground/s/parsiya:tips-detect-single-line-if-block target=_blank rel="noreferrer noopener">https://semgrep.dev/playground/s/parsiya:tips-detect-single-line-if-block</a></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#268bd2>id</span>: detect_if
</span></span><span style=display:flex><span>    <span style=color:#268bd2>patterns</span>:
</span></span><span style=display:flex><span>      - <span style=color:#268bd2>pattern</span>: if ($X) ...
</span></span><span style=display:flex><span>      - <span style=color:#268bd2>pattern-not</span>: if ($X) { $Y; ... }
</span></span><span style=display:flex><span>    <span style=color:#268bd2>message</span>: Found a one-line if block
</span></span><span style=display:flex><span>    <span style=color:#268bd2>languages</span>:
</span></span><span style=display:flex><span>      - c
</span></span><span style=display:flex><span>    <span style=color:#268bd2>severity</span>: WARNING
</span></span></code></pre></div><p>Credit: <a href=https://github.com/kopecs target=_blank rel="noreferrer noopener">Cooper Pierce</a>, r2c, <a href="https://r2c-community.slack.com/archives/C018NJRRCJ0/p1660943282982279?thread_ts=1660942419.479839&cid=C018NJRRCJ0" target=_blank rel="noreferrer noopener">source on r2c Slack</a>.</p><h2 id=array-arguments-in-cc>Array Arguments in C/C++
<a class=header-link href=#array-arguments-in-cc><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><code>$TYPE $VAR[...];</code> is not valid, use <code>$TYPE $VAR[$SIZE];</code>. This also matches
multi-dimensional arrays like <code>int nDim_init[10][10][10][10][10][10];</code>.</p><p><strong>In general:</strong> Use metavariables instead of <code>...</code> in C/C++.</p><h3 id=explanation-1>Explanation
<a class=header-link href=#explanation-1><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><blockquote><p><code>...</code> is usually reserved to match a sequence of things (e.g., <code>foo(...)</code>), or
if something is optional (e.g., <code>return ...;</code>)</p></blockquote><p>Credit: <a href=https://github.com/aryx target=_blank rel="noreferrer noopener">Padioleau Yoann</a>, r2c, <a href="https://r2c-community.slack.com/archives/C018NJRRCJ0/p1648051884724009?thread_ts=1648001009.133229&cid=C018NJRRCJ0" target=_blank rel="noreferrer noopener">source: r2c Slack</a>.</p><h1 id=rule-tests>Rule Tests
<a class=header-link href=#rule-tests><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><h2 id=test-file-names-for-rules-with-the-paths-tag>Test File Names for Rules with the paths Tag
<a class=header-link href=#test-file-names-for-rules-with-the-paths-tag><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I had a rule that was looking for <code>*-NAME.cpp</code> files. E.g.,</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>rules</span>:
</span></span><span style=display:flex><span>- <span style=color:#268bd2>id</span>: some-rule
</span></span><span style=display:flex><span>  <span style=color:#268bd2>languages</span>:
</span></span><span style=display:flex><span>    - cpp
</span></span><span style=display:flex><span>  <span style=color:#268bd2>paths</span>:
</span></span><span style=display:flex><span>    <span style=color:#268bd2>include</span>:
</span></span><span style=display:flex><span>      - <span style=color:#2aa198>&#34;*-NAME.cpp&#34;</span>
</span></span></code></pre></div><p>The test file should match one of the items in <code>include</code>. In this case, I needed
to rename the test file <code>some-rule-NAME.cpp</code>.</p><h1 id=memes>Memes
<a class=header-link href=#memes><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><h2 id=you-made-this>You Made This?
<a class=header-link href=#you-made-this><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Credit: Yours Truly, Parsia.</p><p><img src=you-made-this.png alt="You Made This?"></p></div><footer><p class=meta></span></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#semgrep-on-windows>Semgrep on Windows</a><ul><li><a href=#install-wsl>Install WSL</a></li><li><a href=#which-distro-should-i-choose>Which Distro Should I Choose?</a></li><li><a href=#wsl1-vs-wsl2>WSL1 vs. WSL2</a></li><li><a href=#install-semgrep-on-wsl>Install Semgrep on WSL</a><ul><li><a href=#semgrep-command-not-found>Semgrep Command not Found</a></li></ul></li></ul></li><li><a href=#configs>Configs</a><ul><li><a href=#download-a-ruleset-yaml-file>Download a Ruleset YAML File</a></li><li><a href=#run-all-the-rules>Run ALL the Rules</a></li></ul></li><li><a href=#writing-rules>Writing Rules</a><ul><li><a href=#double-matches-with-different-semgrep-messages>Double Matches with Different Semgrep Messages</a><ul><li><a href=#fix>Fix</a></li><li><a href=#explanation>Explanation</a></li></ul></li><li><a href=#skipping-java-annotations>Skipping Java Annotations</a><ul><li><a href=#fix-1>Fix</a></li></ul></li><li><a href=#pattern-inside-and--or>pattern-inside AND & OR</a></li><li><a href=#if-statements-in-cc>if Statements in C/C++</a></li><li><a href=#array-arguments-in-cc>Array Arguments in C/C++</a><ul><li><a href=#explanation-1>Explanation</a></li></ul></li></ul></li><li><a href=#rule-tests>Rule Tests</a><ul><li><a href=#test-file-names-for-rules-with-the-paths-tag>Test File Names for Rules with the paths Tag</a></li></ul></li><li><a href=#memes>Memes</a><ul><li><a href=#you-made-this>You Made This?</a></li></ul></li></ul></nav></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2022 Parsia-Clone - <a href=https://parsiya.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io>Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/>Hugo-Octopress</a> theme.</p></footer></body></html>