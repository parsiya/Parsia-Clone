<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Gradle Plugin Notes</title>
<link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=https://parsiya.io/clone.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.io/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia-Clone"><meta name=generator content="Hugo 0.120.4"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gradle Plugin Notes"><meta name=twitter:description content="To add a plugin to an existing Java project we can add it under buildSrc. This way we can use it in the project build.gradle without hassle.
https://www.vogella.com/tutorials/Gradle/article.html#apply-the-java-gradle-plugin-plug-in Inside the buildSrc directory, we will need to create a separate Java project with all the bells and whistles. This means we have to create another build.gradle inside.
buildSrc/build.gradle 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 plugins { id 'java-gradle-plugin' } gradlePlugin { plugins { thisDoesntMatter { id = 'mypluginid' implementationClass = 'myplugin."><meta name=twitter:domain content="parsiya.io"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.io/>Parsia-Clone</a></h1><h2>'Documentation is a love letter that you write to your future self.' - Damian Conway</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://github.com/parsiya/Parsia-Clone>» Parsia-Clone on Github</option><option value=https://parsiya.net/categories/clone/>» How did I make this?</option><option value=https://parsiya.net>» My Main Website</option></select></fieldset><ul class=main-navigation><li><a href=https://github.com/parsiya/Parsia-Clone title="Parsia-Clone on Github" target=_blank rel="noopener noreferrer">Parsia-Clone on Github</a></li><li><a href=https://parsiya.net/categories/clone/ title="How did I make this?" target=_blank rel="noopener noreferrer">How did I make this?</a></li><li><a href=https://parsiya.net title="My Main Website" target=_blank rel="noopener noreferrer">My Main Website</a></li></ul><ul class=subscription></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jan 29, 2020 -
5 minute read
- <a class=label href=https://parsiya.io/categories/research/>Research</a></p><h1 class=entry-title>Gradle Plugin Notes</h1><a href=https://github.com/parsiya/Parsia-Clone/tree/main/research/gradle-plugin/index.markdown target=_blank>Github Link</a></header><div class=entry-content><p>To add a plugin to an existing Java project we can add it under <code>buildSrc</code>. This
way we can use it in the project <code>build.gradle</code> without hassle.</p><ul><li><a href=https://www.vogella.com/tutorials/Gradle/article.html#apply-the-java-gradle-plugin-plug-in target=_blank rel="noreferrer noopener">https://www.vogella.com/tutorials/Gradle/article.html#apply-the-java-gradle-plugin-plug-in</a></li></ul><p>Inside the <code>buildSrc</code> directory, we will need to create a separate Java project
with all the bells and whistles. This means we have to create another
<code>build.gradle</code> inside.</p><figure class=code><figcaption><span>buildSrc/build.gradle</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>plugins {
</span></span><span style=display:flex><span>    id &#39;java<span style=color:#719e07>-</span>gradle<span style=color:#719e07>-</span>plugin&#39;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gradlePlugin {
</span></span><span style=display:flex><span>    plugins {
</span></span><span style=display:flex><span>        thisDoesntMatter {
</span></span><span style=display:flex><span>            id <span style=color:#719e07>=</span> &#39;mypluginid&#39;
</span></span><span style=display:flex><span>            implementationClass <span style=color:#719e07>=</span> &#39;myplugin.MyPlugin&#39;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sourceSets {
</span></span><span style=display:flex><span>    main {
</span></span><span style=display:flex><span>        java {
</span></span><span style=display:flex><span>            srcDir <span style=color:#2aa198>&#39;.&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>repositories {
</span></span><span style=display:flex><span>    mavenCentral()
</span></span><span style=display:flex><span>    <span style=color:#586e75>// In case we want to use 3rd party packages in the plugin.</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies {
</span></span><span style=display:flex><span>    <span style=color:#586e75>// No need to add gradleApi() here, because it is applied by the</span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// &#39;java-gradle-plugin&#39; plug-in</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Add your dependencies here.</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>We have pointed <code>srcDir</code> to <code>buildSrc</code> so we have to create our files here.
<code>implementationClass</code> is set to <code>myplugin.MyPlugin</code> meaning that we have to
create a package named <code>myplugin</code> here and a class <code>MyPlugin</code>.</p><figure class=code><figcaption><span>buildSrc/MyPlugin.java</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#719e07>package</span> myplugin;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> org.gradle.api.Plugin;
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> org.gradle.api.Project;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>MyPlugin</span> <span style=color:#268bd2>implements</span> Plugin<span style=color:#719e07>&lt;</span>Project<span style=color:#719e07>&gt;</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>public</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>apply</span>(Project project) {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// Create a task named &#34;install&#34;</span>
</span></span><span style=display:flex><span>        project.getTasks().create(<span style=color:#2aa198>&#34;install&#34;</span>, Installation.class);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>Here we create a task named <code>install</code> which runs another class called
<code>Installation</code>. <code>Installation</code> is part of the same package in this
implementation. This means we need to create a file <code>Installation.java</code> to have
the task.</p><figure class=code><figcaption><span>buildSrc/Installation.java</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#719e07>package</span> myplugin;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> org.gradle.api.DefaultTask;
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> org.gradle.api.tasks.TaskAction;
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> org.gradle.api.tasks.options.Option;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>Installation</span> <span style=color:#268bd2>extends</span> DefaultTask {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String projectPath;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>@Option</span>(option<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;project&#34;</span>, description<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;path to the project&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#268bd2>public</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>setPath</span>(String path) {
</span></span><span style=display:flex><span>        projectPath <span style=color:#719e07>=</span> path;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>@TaskAction</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>public</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>myTask</span>() {
</span></span><span style=display:flex><span>        System.out.printf(<span style=color:#2aa198>&#34;Option value: %s&#34;</span>, projectPath);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>The interesting part of the code is the <code>Option</code>. We can use this to get
parameters/switch from the command line. In this case, we are creating an option
named <code>project</code> and we will store it in <code>projectPath</code>. Now we can do what we
want with <code>projectPath</code>.</p><ul><li><a href=https://docs.gradle.org/current/userguide/custom_tasks.html#sec:declaring_and_using_command_line_options target=_blank rel="noreferrer noopener">https://docs.gradle.org/current/userguide/custom_tasks.html#sec:declaring_and_using_command_line_options</a></li></ul><p>Our plugin is now ready. Now we need to add it to the project <code>build.gradle</code>
which is inside the root directory of the project. Add this line to it:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#586e75>// The id here is the same as</span>
</span></span><span style=display:flex><span>apply plugin: &#39;mypluginid&#39; in `buildSrc<span style=color:#719e07>/</span>build.gradle`.
</span></span></code></pre></div><p>Now we can call this task with a command line parameter from the project
directory. The command line parameter is passed a <code>--project=value</code> or
<code>--project value</code>.</p><pre tabindex=0><code>gradlew install --project=cli-value

&gt; Task :install
Option value: cli-value

BUILD SUCCESSFUL in 956ms
1 actionable task: 1 executed
</code></pre><p>Note that if we pass a parameter that is not defined, we get an error in this
setup.</p><pre tabindex=0><code>gradlew install --param value

FAILURE: Build failed with an exception.

* What went wrong:
Problem configuring task :install from command line.
&gt; Unknown command-line option &#39;--param&#39;.

* Try:
Run gradlew help --task :install to get task usage details.
Run with --stacktrace option to get the stack trace.
Run with --info or --debug option to get more log output.
Run with --scan to get full insights.

* Get more help at https://help.gradle.org
BUILD FAILED in 837ms
</code></pre><h2 id=using-groovy-in-buildgradle>Using Groovy in build.gradle
<a class=header-link href=#using-groovy-in-buildgradle><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>It's also possible to write the task in <code>build.gradle</code> instead.</p><h3 id=executing-shell-commands>Executing Shell Commands
<a class=header-link href=#executing-shell-commands><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>To execute commands per OS (Windows needs <code>cmd.exe /c</code>) we can use:</p><p>Source: <a href=https://stackoverflow.com/a/54315477 target=_blank rel="noreferrer noopener">https://stackoverflow.com/a/54315477</a></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#268bd2>private</span> <span style=color:#268bd2>static</span> Iterable<span style=color:#719e07>&lt;</span>String<span style=color:#719e07>&gt;</span> osAdaptiveCommand<span style=color:#719e07>(</span>String<span style=color:#719e07>...</span> commands<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>    <span style=color:#dc322f>def</span> newCommands <span style=color:#719e07>=</span> <span style=color:#719e07>[]</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>Os<span style=color:#719e07>.</span>isFamily<span style=color:#719e07>(</span>Os<span style=color:#719e07>.</span>FAMILY_WINDOWS<span style=color:#719e07>))</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        newCommands <span style=color:#719e07>=</span> <span style=color:#719e07>[</span><span style=color:#2aa198>&#39;cmd&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;/c&#39;</span><span style=color:#719e07>]</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    newCommands<span style=color:#719e07>.</span>addAll<span style=color:#719e07>(</span>commands<span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span> newCommands
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><p>Now we can create a task like this:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>task <span style=color:#268bd2>executeCommand</span><span style=color:#719e07>(</span>type: Exec<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>    
</span></span><span style=display:flex><span>    commandLine <span style=color:#268bd2>osAdaptiveCommand</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#39;aws&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;ecr&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;get-login&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;--no-include-email&#39;</span><span style=color:#719e07>)</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><h3 id=defining-multiple-commandlines-in-one-task>Defining Multiple commandLines in One Task
<a class=header-link href=#defining-multiple-commandlines-in-one-task><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>We cannot have multiple <code>commandLine</code>s in the same task without <code>exec</code>s.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>task <span style=color:#268bd2>whatever</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    commandLine <span style=color:#2aa198>&#39;cmd.exe&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;/c&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;dir&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    commandLine <span style=color:#268bd2>osAdaptiveCommand</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#39;whatever.exe&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;--switch&#39;</span><span style=color:#719e07>)</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><p>Based on my observation, only the last one will be executed. Instead put each
one in a separate <code>exec</code>. See below.</p><h3 id=defining-multiple-execs-in-one-task>Defining Multiple execs in One Task
<a class=header-link href=#defining-multiple-execs-in-one-task><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>When defining multiple <code>commandLine</code>s, we need to make sure they are not
executed in the configuration phase. I am not sure how it works but if you
create a task like this, it will be executed every time any task is executed.
Meaning the task is executed in the configuration phase.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>task <span style=color:#268bd2>whatever</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>    exec <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        <span style=color:#586e75>// optional workingDir &#39;path/to/workingdir`
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        commandLine <span style=color:#2aa198>&#39;cmd.exe&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;/c&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;dir&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span>    exec <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        commandLine <span style=color:#268bd2>osAdaptiveCommand</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#39;whatever.exe&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;--switch&#39;</span><span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><p>Both of these execs will run whenever any task is executed.</p><p>The solution is to put it in <code>doLast</code>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>task <span style=color:#268bd2>whatever</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>    doLast <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        exec <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        <span style=color:#586e75>// optional workingDir &#39;path/to/workingdir`
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>            commandLine <span style=color:#2aa198>&#39;cmd.exe&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;/c&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;dir&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span>        exec <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>            commandLine <span style=color:#268bd2>osAdaptiveCommand</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#39;whatever.exe&#39;</span><span style=color:#719e07>,</span> <span style=color:#2aa198>&#39;--switch&#39;</span><span style=color:#719e07>)</span>
</span></span><span style=display:flex><span>        <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><h3 id=accessing-command-line-parameters>Accessing Command Line Parameters
<a class=header-link href=#accessing-command-line-parameters><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>If the command line parameter is always provided. Access it with <code>$param</code> and
pass it to the Gradle task like this <code>gradle taskname -Pparam=value</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>task <span style=color:#268bd2>whatever</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>    doLast <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        println <span style=color:#2aa198>&#34;param = $param&#34;</span> <span style=color:#586e75>// Note that we have to use double-quotes.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span><span style=display:flex><span><span style=color:#586e75>// Run `gradle whatever -Pparam=value`
</span></span></span></code></pre></div><ol><li>Some parameters are reserved and already have values like <code>$path</code> and
<code>$project</code>.</li><li>If the parameter is not provided to the task an exception occurs.<ul><li><code>Could not get unknown property 'param' for task ':whatever' of type org.gradle.api.DefaultTask.</code></li></ul></li></ol><p>A better way is to use <code>project.hasProperty('param')</code> to check if the project
has such a property first.</p><p><a href=https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html#hasProperty-java.lang.String- target=_blank rel="noreferrer noopener">https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html#hasProperty-java.lang.String-</a></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>task <span style=color:#268bd2>whatever</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>    doLast <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>        <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>project<span style=color:#719e07>.</span>hasProperty<span style=color:#719e07>(</span><span style=color:#2aa198>&#39;param&#39;</span><span style=color:#719e07>))</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>            println <span style=color:#2aa198>&#34;param = $param&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#719e07>}</span> <span style=color:#719e07>else</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>            <span style=color:#586e75>// Can also use else.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>}</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><h3 id=get-current-working-directory>Get Current Working directory
<a class=header-link href=#get-current-working-directory><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><ul><li><code>System.properties['user.dir']</code><ul><li><a href=https://stackoverflow.com/a/6492287 target=_blank rel="noreferrer noopener">https://stackoverflow.com/a/6492287</a></li></ul></li></ul><p>To get the script path:</p><ul><li>scriptFile = getClass().protectionDomain.codeSource.location.path<ul><li><a href=https://stackoverflow.com/a/1169196 target=_blank rel="noreferrer noopener">https://stackoverflow.com/a/1169196</a></li></ul></li></ul></div><footer><p class=meta><span class=categories>Tags:
<a class=category href=https://parsiya.io/tags/java>Java</a> <a class=category href=https://parsiya.io/tags/gradle>Gradle</a></span></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><ul><li><a href=#using-groovy-in-buildgradle>Using Groovy in build.gradle</a><ul><li><a href=#executing-shell-commands>Executing Shell Commands</a></li><li><a href=#defining-multiple-commandlines-in-one-task>Defining Multiple commandLines in One Task</a></li><li><a href=#defining-multiple-execs-in-one-task>Defining Multiple execs in One Task</a></li><li><a href=#accessing-command-line-parameters>Accessing Command Line Parameters</a></li><li><a href=#get-current-working-directory>Get Current Working directory</a></li></ul></li></ul></li></ul></nav></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2023 Parsia-Clone - <a href=https://parsiya.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>