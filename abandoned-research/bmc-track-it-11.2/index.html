<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>BMC Track It 11.2</title>
<link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=https://parsiya.io/clone.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.io/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia-Clone"><meta name=generator content="Hugo 0.122.0"><meta name=twitter:card content="summary"><meta name=twitter:title content="BMC Track It 11.2"><meta name=twitter:description content="BMC Track It 11.2 Download BMC Track It 11.2 from CNET. http://download.cnet.com/BMC-Track-It/3000-18482_4-10003961.html?tag=bc
Disconnect your VM from the internet because you don't want to be vulnerable.
First we install it. After installation:
Low and behold we have something listening on port 9010 (on all interfaces).
PS C:\> netstat -an | findstr.exe &#34;9010&#34;TCP 0.0.0.0:9010 0.0.0.0:0 LISTENINGPS C:\>pic01
But now we have the problem of finding the module that is listening on port 9010."><meta name=twitter:domain content="parsiya.io"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.io/>Parsia-Clone</a></h1><h2>'Documentation is a love letter that you write to your future self.' - Damian Conway</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://github.com/parsiya/Parsia-Clone>» Parsia-Clone on Github</option><option value=https://parsiya.net/categories/clone/>» How did I make this?</option><option value=https://parsiya.net>» My Main Website</option></select></fieldset><ul class=main-navigation><li><a href=https://github.com/parsiya/Parsia-Clone title="Parsia-Clone on Github" target=_blank rel="noopener noreferrer">Parsia-Clone on Github</a></li><li><a href=https://parsiya.net/categories/clone/ title="How did I make this?" target=_blank rel="noopener noreferrer">How did I make this?</a></li><li><a href=https://parsiya.net title="My Main Website" target=_blank rel="noopener noreferrer">My Main Website</a></li></ul><ul class=subscription></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>4 minute read
- <a class=label href=https://parsiya.io/categories/abandoned-research/>Abandoned Research</a></p><h1 class=entry-title>BMC Track It 11.2</h1><a href=https://github.com/parsiya/Parsia-Clone/tree/main/abandoned-research/BMC-Track-It-11.2.md target=_blank>Github Link</a></header><div class=entry-content><h1 id=bmc-track-it-112>BMC Track It 11.2
<a class=header-link href=#bmc-track-it-112><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Download BMC Track It 11.2 from CNET. <a href="http://download.cnet.com/BMC-Track-It/3000-18482_4-10003961.html?tag=bc" target=_blank rel="noreferrer noopener">http://download.cnet.com/BMC-Track-It/3000-18482_4-10003961.html?tag=bc</a></p><p>Disconnect your VM from the internet because you don't want to be vulnerable.</p><p>First we install it. After installation:</p><p>Low and behold we have something listening on port 9010 (on all interfaces).</p><pre><code>PS C:\&gt; netstat -an | findstr.exe &quot;9010&quot;
  TCP    0.0.0.0:9010           0.0.0.0:0              LISTENING
PS C:\&gt;
</code></pre><p><strong>pic01</strong></p><p>But now we have the problem of finding the module that is listening on port 9010.</p><p>For that we can use the <code>b</code> switch for <code>netstat</code> which needs an admin powershell window or command prompt.</p><pre><code>PS C:\&gt; netstat -ab

Active Connections
  Proto  Local Address          Foreign Address        State
  ...

 TCP    0.0.0.0:5357           x64-PC:0               LISTENING
 Can not obtain ownership information

  TCP    0.0.0.0:6712           x64-PC:0               LISTENING
 [TIHost.exe]

  TCP    0.0.0.0:9010           x64-PC:0               LISTENING
 [TIServiceManagement.exe]

  TCP    0.0.0.0:49176          x64-PC:0               LISTENING
 [sqlservr.exe]

  TCP    127.0.0.1:49176        x64-PC:49519           ESTABLISHED
 [sqlservr.exe]

  TCP    127.0.0.1:49519        x64-PC:49176           ESTABLISHED
 [TIServiceManagement.exe]
   ...
</code></pre><p>So we have two open ports <code>6712</code> and <code>9010</code>.</p><p>We can see that they are running as SYSTEM according to this screenshot from task manager.</p><p><strong>pic02</strong></p><p>And one is a service.</p><p><strong>[pic03]</strong></p><p>At this point we do not know what is running on port <code>5357</code> but if we telnet to it we will see some familiar response:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>HTTP/1.1 400 Bad Request
</span></span><span style=display:flex><span>Content-Type: text/html; charset=us-ascii
</span></span><span style=display:flex><span>Server: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>Date: Wed, 28 Oct 2015 01:35:23 GMT
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Content-Length: 326
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>&lt;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 4.01//EN&#34;&#34;http://www.w3.org/TR/html4/strict.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#268bd2>HTML</span>&gt;&lt;<span style=color:#268bd2>HEAD</span>&gt;&lt;<span style=color:#268bd2>TITLE</span>&gt;Bad Request&lt;/<span style=color:#268bd2>TITLE</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#268bd2>META</span> HTTP-EQUIV<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;Content-Type&#34;</span> Content<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;text/html; charset=us-ascii&#34;</span>&gt;&lt;/<span style=color:#268bd2>HEAD</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#268bd2>BODY</span>&gt;&lt;<span style=color:#268bd2>h2</span>&gt;Bad Request - Invalid Verb&lt;/<span style=color:#268bd2>h2</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#268bd2>hr</span>&gt;&lt;<span style=color:#268bd2>p</span>&gt;HTTP Error 400. The request verb is invalid.&lt;/<span style=color:#268bd2>p</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#268bd2>BODY</span>&gt;&lt;/<span style=color:#268bd2>HTML</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection to host lost.
</span></span></code></pre></div><p>This is interesting, but not what we are looking for. Maybe we will come back to it later.</p><p>Connect to <code>localhost:9010</code> with telnet or your browser and observe the error message which indicates that we are on the right track.</p><pre><code>.NET..........System.Runtime.Remoting.RemotingException: Tcp channel protocol violation: expecting preamble.
   at System.Runtime.Remoting.Channels.Tcp.TcpSocketHandler.ReadAndMatchPreamble()
   at System.Runtime.Remoting.Channels.Tcp.TcpSocketHandler.ReadVersionAndOperation(UInt16&amp; operation)
   at System.Runtime.Remoting.Channels.Tcp.TcpServerSocketHandler.ReadHeaders()
   at System.Runtime.Remoting.Channels.Tcp.TcpServerTransportSink.ServiceRequest(Object state)
   at System.Runtime.Remoting.Channels.SocketHandler.ProcessRequestNow()

Connection to host lost.
</code></pre><p>Navigate to <code>C:\Program Files (x86)\BMC Software\Track-It!\Track-It! Services</code> which contains the <code>TIServiceManagement.exe</code> executable and look inside the config file <code>TIServiceManagement.exe.config</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#268bd2>&lt;appSettings&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;ConfigurationRemotingChannel&#34;</span> value=<span style=color:#2aa198>&#34;tcp&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;ConfigurationRemotingHost&#34;</span> value=<span style=color:#2aa198>&#34;x64-PC&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;ConfigurationRemotingPort&#34;</span> value=<span style=color:#2aa198>&#34;9010&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>&lt;!--Remoting Services Manager--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;RemotingServiceClass&#34;</span> value=<span style=color:#2aa198>&#34;TrackIt.Core.ServiceManagement.ServiceManagementImpl.ServiceManagementServer,TrackIt.Core.ServiceManagement.ServiceManagementImpl&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;RemotingServiceName&#34;</span> value=<span style=color:#2aa198>&#34;TIServiceManagement&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;RemotingServiceDisplayName&#34;</span> value=<span style=color:#2aa198>&#34;Track-It! Service Management&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;RemotingServiceDescription&#34;</span> value=<span style=color:#2aa198>&#34;Manages services instances deployed on this host.&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;add</span> key=<span style=color:#2aa198>&#34;SystemHealth:SystemHealthConfiguration:TrackIt.Core.Configuration.MultisourceConfigurationImpl.DatabaseConfigurationSource&#34;</span> value=<span style=color:#2aa198>&#34;Database source&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>&lt;/appSettings&gt;</span>
</span></span></code></pre></div><p>Look at <code>Properties > Details</code> for <code>TIServicemanagement.exe</code> and we will see that the file description is <code>RemotingServicesManager</code> as well as its original filename.</p><p><strong>[pic04]</strong></p><p>Here's the thing, we can open the file in dnSpy and poke around but let's cut the chase and look at the local traffic.</p><p>To capture local traffic [link to the capturing local traffic blog post] we will use RawCap. Run RawCap, start capturing on the pseudo loopback interface. Now start the application and login. The demo user does not have a password.</p><p><strong>[pic05]</strong></p><p>And we can see the contents (well the printable parts) by using <code>Follow TCP Stream</code>.</p><p><strong>[pic06]</strong></p><p>We have seen the first request before (I have filtered out a lot of non-printable characters unless they are needed and we are going to talk about them).</p><pre><code>.NET 3 tcp://x64-PC:9010/TrackIt.Core.ConfigurationService.
</code></pre><p>Second request</p><pre><code>GetProductDeploymentValues TrackIt.Core.Configuration.IConfigurationSecureDelegator, TrackIt.Core.Configuration, Version=11.2.0.345, Culture=neutral, PublicKeyToken=null
</code></pre><p>As we have seen before [link to the first .NET remoting post] we can find the DLL and the object that is being called remotely.</p><pre><code>Remote function: GetProductDeploymentValues
Function class: TrackIt.Core.Configuration.IConfigurationSecureDelegator
DLL: TrackIt.Core.Configuration
</code></pre><p>The application that called the remote object is <code>C:\Program Files (x86)\BMC Software\Track-It!\Track-It! Server\Installers\TechnicianClient\en\TechnicianClient_11_2_0_345\TechnicianClient.exe</code>. The DLL is question is in the same address.</p><p><strong>[pic07]</strong></p><p>These look to be the list of all exposed functions. <code>GetFileContent</code> looks nice.</p><p><strong>[pic7.5]</strong></p><p>Now we want to know when it is called. If we remember from .NET Remoting primers we know that an instance of this function will be created and sent over. Rightclick the function and select <code>Analyze</code> and a panel appears. In the panel select <code>Used By</code>. This shows every where in loaded binaries (executables and DLLs) that this function is used. In case it is in the same DLL (<code>TrackIt.Core.Configuration.dll</code>) and the function is <code>TrackIt.Core.Configuration.ConfigurationInterceptor. GetProductDeploymentValues()</code>. Pretty handy neh?</p><p><strong>[pic08]</strong></p><p>Let's put a breakpoint here and run <code>TechnicianClient.exe</code> in dnSpy. Now if we want to see how we got here we can use <code>Debug (menu) > Show Call Stack</code>. Isn't this nice?</p><p><strong>[pic09]</strong></p><p>Now if we step into three times, we will reach the familiar code base in <code>mscorlib.dll</code> at <code>CommonLanguageRuntimeLibrary.System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke</code>.</p><p><strong>[pic10]</strong></p><p><code>type</code> equals <code>1</code> so the if statement will be true, now if we step until we after line 408 or <code>message = expr_14;</code> (remember that breakpoints set here will not trigger). We can inspect the variable <code>message</code> and see the method being called and its arguments if it had any (remember that <code>Alt+4</code> will open the <code>Locals</code> panel.</p><p><strong>[pic11]</strong></p><p>Great, now we have a decent idea of what is happening here with regards to .NET Remoting. If we go to the <code>C:\Program Files (x86)\BMC Software\Track-It!\Track-It! Services</code> directory we will see the a similar set of DLLs (both caller and callee have a copy of methods). In this case the DLL is <code>TrackIt.Core.Configuration.dll</code></p><p><strong>[pic12]</strong></p><p>We can use this DLL to create our own app that connects to the service and does stuff.</p></div><footer><p class=meta><span class=categories>Tags:
<a class=category href=https://parsiya.io/tags/.net-remoting>.NET Remoting</a></span></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#bmc-track-it-112>BMC Track It 11.2</a></li></ul></nav></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2024 Parsia-Clone - <a href=https://parsiya.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>